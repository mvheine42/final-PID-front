<div class="conteiner">
  <div class="menu-header">
    <div class="bar-info">
      <img src="assets/images/taza.png" alt="Logo del Bar" class="bar-logo"/>
      <h1 class="bar-name">C&V BAR</h1>
    </div>
  </div>

  <main class="hero">
    <div class="reservation-box">
      <h2 class="title">Make a reservation</h2>

      <form class="p-fluid" #reserveForm="ngForm" (ngSubmit)="createReservation()">
        <div class="p-field">
          <label for="customerName">
            Name 
            <span class="char-counter">{{ customerName.length }}/{{ MAX_NAME_LENGTH }}</span>
          </label>
          <input
            id="customerName"
            type="text"
            pInputText
            [(ngModel)]="customerName"
            name="customerName"
            placeholder="Ej: Wanda Nara"
            [maxlength]="MAX_NAME_LENGTH"
            [disabled]="isLoading"
            required
          />
          <small *ngIf="customerName.length >= MAX_NAME_LENGTH" class="p-error">
            Maximum {{ MAX_NAME_LENGTH }} characters.
          </small>
        </div>

        <div class="p-field">
          <label for="userEmail">Email</label>
          <input
            id="userEmail"
            type="email"
            pInputText
            [(ngModel)]="userEmail"
            name="userEmail"
            (ngModelChange)="validateEmail()"
            placeholder="wandanara@gmail.com"
            [disabled]="isLoading"
            required
          />
          <small *ngIf="!emailValid && userEmail" class="p-error">
            Please enter a valid email.
          </small>
        </div>

        <div class="p-field">
          <label for="amountOfPeople">Party</label>
          <input
            id="amountOfPeople"
            type="number"
            pInputText
            [(ngModel)]="amountOfPeople"
            name="amountOfPeople"
            min="1"
            max="4"
            [disabled]="isLoading"
            required
          />
          <small *ngIf="amountOfPeople > 4" class="p-error">
            Maximum 4 people.
          </small>
        </div>

        <div class="p-field">
          <label for="reservationDate">Date</label>
          <p-calendar
            id="reservationDate"
            [(ngModel)]="reservationDate"
            name="reservationDate"
            [minDate]="tomorrowLocal"
            [maxDate]="maxDateLocal"
            dateFormat="dd/mm/yy"
            [showIcon]="true"
            inputId="reservationDate"
            (onSelect)="onDateChange($event)"
            [disabled]="isLoading"
            required>
          </p-calendar>
        </div>

        <div class="p-field">
          <label for="reservationTime">
            Time
            <span *ngIf="loadingAvailability" class="loading-text">
              <i class="pi pi-spin pi-spinner" style="font-size: 0.9rem; margin-left: 5px;"></i>
              Loading availability
            </span>
          </label>
          <p-dropdown
            id="reservationTime"
            [(ngModel)]="reservationTime"
            name="reservationTime"
            [options]="timesForUI"
            [optionDisabled]="'disabled'"
            placeholder="Seleccioná horario"
            [disabled]="isLoading || !reservationDate"
            required>
          </p-dropdown>
          <small *ngIf="!reservationDate" class="p-info">
            Please select a date first.
          </small>
        </div>

        <div class="p-field">
          <button
            pButton
            type="submit"
            [label]="isLoading ? 'Processing...' : 'Confirm reservation'"
            [disabled]="!isFormValid() || isLoading">
            <i *ngIf="creatingReservation || sendingEmail" class="pi pi-spin pi-spinner button-spinner"></i>
          </button>
        </div>
      </form>
    </div>
  </main>

  <div *ngIf="creatingReservation || sendingEmail" class="overlay">
    <div class="spinner-container">
      <p-progressSpinner styleClass="custom-spinner" [animationDuration]="'0.5'"></p-progressSpinner>
      <p class="loading-message" *ngIf="creatingReservation && !sendingEmail">Creating your reservation...</p>
      <p class="loading-message" *ngIf="sendingEmail">Sending confirmation email...</p>
    </div>
  </div>


  <p-dialog
    [(visible)]="isNoticeVisible"
    [modal]="true"
    [closable]="true"
    [baseZIndex]="20000"
    [style]="{width: '90%', maxWidth: '500px'}"
    [header]="isSuccessReservation ? '✅ Reservation confirmed' : '⚠️ Attention'">
    
    <div class="notice-content">
      <div style="white-space: pre-line;">{{ noticeMessage }}</div>
    </div>

    <ng-template pTemplate="footer">
      <button pButton label="Cerrar" (click)="closeDialog()" class="notice-button"></button>
    </ng-template>
  </p-dialog>
</div>